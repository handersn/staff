<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.staff.dao.StaffDao">

  <resultMap type="Staff" id="staffMap">
    <id column="eno" property="eno"/>
    <result column="position" property="position"/>
    <result column="name" property="name"/>
    <result column="email" property="email"/>
    <result column="phone" property="phone"/>
  </resultMap>
  
  <sql id="staffSelect">
  	SELECT eno,position,name,email,phone
  	FROM members
  </sql>
  
  <select id="selectAllStaffs" resultMap="staffMap">
    <include refid="staffSelect"/>
  </select>
  
  <select id="findStaffs" parameterType="map" resultType="staffMap">
   <include refid="staffSelect"/>
   WHERE
   <if test="position != null">
    position = #{position}
   </if>
   <if test="name != null">
    position = #{position}
   </if>
   <if test="position != null">
    position = #{position}
   </if>
  </select>
  
  <insert id="insert" parameterType="Member">
    INSERT INTO MEMBERS(mno,email,pwd,uname,sex,birth,phone,lcode) 
    VALUES (mno.nextval,#{email}, #{password}, #{userName}, #{sex}, #{birthDate}, #{phone}, #{selectLocal})
  </insert>
  
  <!--회원정보 수정  -->
  <select id="userInfo" parameterType="int" resultMap="memberMap">
   SELECT T1.mno, T1.email, T1.pwd, T1.uname, T1.birth, T1.nick, T1.phone, T1.sex, T1.myphoto, T1.intro, T1.lcode, T2.lname
   FROM MEMBERS T1, SLOCAL T2
   WHERE T1.mno = #{memberNo} AND T1.lcode = T2.lcode  
  </select>
  
  <!--주소 파싱  -->
  <select id="userInfo1" parameterType="int" resultType="string">
   SELECT lname 
   FROM slocal 
   WHERE lcode = 
   (SELECT substr(lcode, 1, 2)
    FROM MEMBERS
    WHERE mno = #{value}) 
  </select>

	<select id="selectGroupMembers" parameterType="int" resultType="map">
		SELECT uname, birth, nick, phone, sex, myphoto, intro,
		T2.manager_status
		FROM members T1, gmembers T2
		WHERE T2.gno = #{gno} and
		T1.MNO = T2.MNO
	</select>
	
  <update id="edit" parameterType="Member">
    UPDATE MEMBERS 
    SET email = #{email},
        uname = #{userName},
        birth = #{birthDate},
        nick = #{nickName}, 
        phone = #{phone}, 
        sex = #{sex}, 
        intro = #{introWord}, 
        lcode = #{selectLocal}
    WHERE mno = #{memberNo}
  </update>
  
  <!--프로필 업로드  -->
  <update id="insertPhoto" parameterType="Member">
    UPDATE MEMBERS
    SET
     myphoto = #{userPhoto} 
    WHERE mno= #{memberNo}
  </update> 
  
  <!--아이디 찾기  -->
  <select id="getId" parameterType="map" resultType="String">
  SELECT email
  FROM MEMBERS
  WHERE uname = #{name} AND birth = #{birthDate}
         AND phone = #{phone}
   
  </select>
  
  <!--비밀번호 찾기  -->
  <select id="getPw" parameterType="map" resultType="String">
  SELECT pwd
  FROM MEMBERS
  WHERE uname = #{name} AND birth = #{birthDate}
         AND email = #{email}
  </select>
</mapper>
